<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>TURTLEDOVE demo UI</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="static/css/normalize.css">
    <link rel="stylesheet" href="static/css/skeleton.css">
    <style>
        body {
            background: #ebdcff;
        }

        iframe {
            border: none;
        }

        th {
            font-weight: bold;
        }

        table {
            border-collapse: collapse;
        }

        table, th, td {
            border: 1px solid black;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.11.0/beautify.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.11.0/beautify-css.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.11.0/beautify-html.js"></script>
</head>
<body>
<script src="static/turtledove-ui.js"></script>
<div class="container" style="margin-top: 5%">
    <h1>TURTLEDOVE demo UI</h1>
    <p>
        This is a simple user interface of a simulation created to visualize and help to understand a <a
            href="https://github.com/WICG/turtledove">TURTLEDOVE proposal</a> - a
        novel approach to privacy in online advertising. To know more about how to explore our demo, check out
        <a href="https://github.com/dervan/turtledove-demo">README in our repo</a>.
    </p>
    <h2>Data reset</h2>
    <p>If you want to delete all data from demo local storage, use this button:</p>
    <button class="button-primary" onclick="removeFetchedAds();removeWinnersHistory();removeLogs();restartConsole();location.reload();">
        Clean data
    </button>
    <h2>Fetched ads</h2>
    <p>
        All ads fetched because of joining an interest group:
    </p>
    <table id="fetched-ads">
        <thead>
        <tr>
            <th>Ad id</th>
            <th>Ad</th>
            <th>Bidding function</th>
            <th>User group signals</th>
        </tr>
        </thead>
    </table>
    <script>
      const formatterOptions = {
        'indent_size': '4',
        'indent_char': ' ',
        'max_preserve_newlines': '1',
        'preserve_newlines': true,
        'keep_array_indentation': false,
        'break_chained_methods': false,
        'indent_scripts': 'normal',
        'brace_style': 'collapse',
        'space_before_conditional': true,
        'unescape_strings': false,
        'jslint_happy': false,
        'end_with_newline': false,
        'wrap_line_length': '40',
        'indent_inner_html': false,
        'comma_first': false,
        'e4x': false,
        'indent_empty_lines': false
      }
      const table = document.getElementById('fetched-ads')
      for (const adDescription of listAds()) {
        const row = table.insertRow()
        const groupId = row.insertCell()
        groupId.innerHTML =
          `Group ID:<br/>
                 <b>${adDescription.groupId}</b><br/>
                 Ad partner: <br/>
                 ${adDescription.adPartner}<br/>
                 <p><button class="button" style="margin: 10px" onclick="removeAd('${adDescription.groupId}');window.location.reload();">Remove</button></p>`
        const ad = row.insertCell()
        const iframe = document.createElement('iframe')
        iframe.srcdoc = adDescription.fetchedAd.iframeContent
        iframe.height = '250px'
        iframe.width = '300px'
        iframe.scrolling = 'no'
        ad.appendChild(iframe)
        const bidFunction = row.insertCell()
        bidFunction.innerHTML = '<pre>' + js_beautify(adDescription.fetchedAd.bidFunction, formatterOptions) + '</pre>'
        const ugSginals = row.insertCell()
        ugSginals.innerHTML = '<pre>' + js_beautify(JSON.stringify(adDescription.fetchedAd.interestGroupSignals)) + '</pre>'
      }
    </script>

    <h2>Shown ads</h2>
    <p>
        This table contains all ads that won an auction in the past, together with a price and a publisher's address.
    </p>
    <table id="winners-ads">
        <thead>
        <tr>
            <th>Website</th>
            <th>Price</th>
            <th>Ad</th>
            <th>Context signals</th>
            <th>Time</th>
        </tr>
        </thead>
    </table>
    <script>
      const winnersTable = document.getElementById('winners-ads')
      for (const winner of listWinners()) {
        const row = winnersTable.insertRow()
        const site = row.insertCell()
        site.innerText = winner.site
        const price = row.insertCell()
        price.innerText = winner.bidValue
        const ad = row.insertCell()
        const iframe = document.createElement('iframe')
        iframe.srcdoc = winner.iframeContent
        iframe.height = '250px'
        iframe.width = '300px'
        iframe.scrolling = 'no'
        ad.appendChild(iframe)
        const ctxSignals = row.insertCell()
        ctxSignals.innerHTML = winner.contextSignals ? '<pre>' + js_beautify(JSON.stringify(winner.contextSignals)) + '</pre>' : ''
        const time = row.insertCell()
        time.innerHTML = winner.time
      }
    </script>
</div>
</body>
</html>